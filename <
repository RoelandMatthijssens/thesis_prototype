function Graph(){
	//variables
	var width = 900;
	var height = 900;

	var allData = []

	var nodeMinSize = 3;
	var nodeMaxSize = 12;

	var force = d3.layout.force()

	var nodeGroup = null;
	var linkGroup = null;
	var node = null;
	var link = null;
	var currentNodeData = [];
	var currentLinkData = [];

	var layout;
	
	//main function
	function graph(container, data){
		//format the data
		allData = data;

		//create svg container
		var vis = d3.select(container).append("svg")
			.attr("width", width)
			.attr("height", height)
			;
		//create groups for links/nodes
		linkGroup = vis.append("g")
			.attr("id", "links");
		nodeGroup = vis.append("g")
			.attr("id", "nodes");

		allData = setupData(data);
		setupForce(force);
		setFilter("all");
		setLayout("force");

		update();
	}

	function update(){
		currentNodeData = filterNodes(allData.nodes);
		currentLinkData = filterLinks(allData.links);

		applyLayout();
	}

	function applyLayout(){
		//based on the layout, manipulate the graph
		if (layout == "force"){
			force.nodes(currentNodeData);
			updateNodes();
			force.links(currentLinkData);
			updateLinks();
			force.start();
		}
	}

	function setupData(data){
		//map countRange to sizeDomain
		var countRange = d3.extent(data.nodes, function(d){return d.visitedCount});
		var sizeScale = d3.scale.sqrt().range([nodeMinSize, nodeMaxSize]).domain(countRange);

		//give the nodes some random position/size
		data.nodes.forEach(function(node){
			node.x = 200;
			node.y = 200;
			node.radius = sizeScale(node.visitedCount);
		});
		nodesMap = mapNodes(data.nodes);

		//point the source/target of links to nodes, instead of identifiers
		data.links.forEach(function(link){
			link.source = nodesMap.get(link.source);
			link.target = nodesMap.get(link.target);
		});

		return data;
	}

	function mapNodes(nodes){
		var map = d3.map();
		nodes.forEach(function(node){
			map.set(getNodeIdentifier(node), node);
		});
		console.log(map);
		return map;
	}

	function filterNodes(data){
		return data;
	}

	function filterLinks(data){
		return data;
	}

	//******************
	//*Render functions*
	//******************

	function updateNodes(){
		node = nodeGroup.selectAll("circle.node")
			.data(currentNodeData, function(d){return getNodeIdentifier(d)});
		
		node.enter().append("circle")
			.attr("class", "node")
			.attr("cx", function(d){return d.x})
			.attr("cy", function(d){return d.y})
			.attr("r" , function(d){return d.radius})
			.style("stroke", "black")
			.style("fill", "black")
			.style("stroke-width", 1.0)
			;
		
		node.exit().remove();
	}

	function updateLinks(){
		console.log("test");
		link = linkGroup.selectAll("line.link")
			.data(currentLinkData, function(d){return getLinkIdentifier(d)});
		console.log(link);

		link.enter().append("line")
			.attr("class", "link")
			.attr("stroke", "#ddd")
			.attr("stroke-opacity", 0.8)
			.attr("x1", 470)//function(d){console.log(d.source.x);return d.source.x})
			.attr("y1", 460)//function(d){console.log(d.source.y);return d.source.y})
			.attr("x2", 420)//function(d){console.log(d.target.x);return d.target.x})
			.attr("y2", 420)//function(d){console.log(d.target.y);return d.target.y})
			;

		link.exit().remove();
	}

	//******************
	//*Helper functions*
	//******************

	function getNodeIdentifier(node){
		console.log(node.selection);
		return node.selection;
	}

	function getLinkIdentifier(link){
		return getNodeIdentifier(link.source)+"_"+getNodeIdentifier(link.target);
	}

	function setupForce(force){
		force.size([width, height]);
		setLayout("force");
		setFilter("all");
	}

	function setFilter(newFilter){
		filter = newFilter;
	}
	function setSort(newSort){
		sort = newSort;
	}
	function setLayout(newLayout){
		layout = newLayout;
		if (layout == "force"){
			force.on("tick", forceTick)
				.charge(-200)
				.linkDistance(50)
				;
		}
	}

	function forceTick(event){
		console.log("tick");
		node
			.attr("cx", function(d){return d.x})
			.attr("cy", function(d){return d.y})

		link
			.attr("x1", function(d){d.source.x})
			.attr("y1", function(d){d.source.y})
			.attr("x2", function(d){d.target.x})
			.attr("y2", function(d){d.target.y})
	}

	return graph;
}

window.onload = function(){
	var myGraph = Graph();

	d3.json("data/data.json", function(json){
		myGraph("#vis", json);
	});
}
